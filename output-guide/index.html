<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Output files - genome-grist docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">genome-grist docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../quickstart/" class="nav-link">Quickstart</a>
                            </li>
                            <li class="nav-item">
                                <a href="../configuring/" class="nav-link">Configuring</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Output files</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../configuring/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#a-guide-to-genome-grist-output-files" class="nav-link">A guide to genome-grist output files</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#configuring-your-output-directory" class="nav-link">Configuring your output directory</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#files-and-subdirectories-within-outdir" class="nav-link">Files and subdirectories within {outdir}</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#second-pass-mapping-the-files-in-leftover" class="nav-link">Second-pass mapping - the files in leftover/</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#details-of-specific-output-files" class="nav-link">Details of specific output files</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="a-guide-to-genome-grist-output-files">A guide to genome-grist output files</h1>
<p>genome-grist runs many steps and because of that it creates <em>a lot</em> of
output files. In brief, genome-grist can do some or all of the following
steps:</p>
<ul>
<li>downloads and trims metagenomes from the SRA;</li>
<li>runs <code>sourmash gather</code> on Genbank or GTDB databases to find genomes;</li>
<li>downloads matching genomes from Genbank;</li>
<li>maps metagenome reads to the downloaded genomes;</li>
<li>does a
  <a href="#second-pass-mapping-the-files-in-leftover">second round of mapping</a>
  that ensures reads are not double-counted;</li>
<li>produces summary reports of metagenome composition, taxonomy, and mapping;</li>
</ul>
<p>and each of these steps has its own set of outputs.</p>
<p>Below is a guide to the various outputs! We welcome questions and
comments; please ask questions in
<a href="https://github.com/dib-lab/genome-grist/issues">the genome-grist issue tracker</a>
as you have them!</p>
<h2 id="configuring-your-output-directory">Configuring your output directory</h2>
<p>genome-grist places all files in the <code>{outdir}</code> folder, which must be
set in the config file; for example, if your config file contains</p>
<pre><code>outdir: outputs.metag
</code></pre>
<p>then all of the directories below will be created under <code>outputs.metag/</code>.</p>
<h2 id="files-and-subdirectories-within-outdir">Files and subdirectories within {outdir}</h2>
<p>Below, we use "sample" and "metagenome" interchangeably.</p>
<h3 id="metagenome-reads">Metagenome reads</h3>
<ul>
<li><code>{outdir}/raw/</code> - untrimmed reads, from the SRA or private sequencing.</li>
<li><code>{outdir}/trim/</code> - adapter and quality-trimmed reads, starting from <code>raw/</code>; inputs into downstream steps.</li>
<li><code>{outdir}/abundtrim/</code> - optional output of variable-coverage k-mer trimming; not used in genome-grist.</li>
</ul>
<h3 id="sourmash-output">sourmash output</h3>
<ul>
<li><code>{outdir}/sigs/</code> - sourmash sketches calculated from trimmed reads in <code>{outdir}/trim/</code>.</li>
<li><code>{outdir}/gather/</code> - sourmash outputs; see details below.</li>
</ul>
<h3 id="genomes-and-mapping-information">Genomes and mapping information</h3>
<ul>
<li><code>{outdir}/genomes/</code> - sequence files and associated information for any genomes found in a sample.</li>
<li><code>{outdir}/mapping/</code> - mapping results for sample reads to genomes.</li>
<li><code>{outdir}/leftover/</code> - "leftover" mapping results for second-pass mapping; see details below.</li>
</ul>
<h3 id="reporting-and-summary-output">Reporting and summary output</h3>
<ul>
<li><code>{outdir}/reports/</code> - summary reports of sourmash gather output, minimap output, and sourmash taxonomy.</li>
<li><code>{outdir}/{sample}.info.yaml</code> - summary information on each sample</li>
</ul>
<h2 id="second-pass-mapping-the-files-in-leftover">Second-pass mapping - the files in <code>leftover/</code></h2>
<p>genome-grist actually does <em>two</em> different rounds of mapping.</p>
<p>The first round is straightforward mapping: all reads are mapped to all genomes. In brief, the metagenome reads are mapped to all genomes from the <a href="https://www.biorxiv.org/content/10.1101/2022.01.11.475838v2">minimum metagenome cover</a> generated by <code>sourmash gather</code>. All of the statistics and outputs in the <code>{outdir}/mapping/</code> location come from this process.</p>
<p>Crucially, during this process, reads may map to more than one genome. There is no specialized handling of multi-mapping reads.</p>
<p>During the second pass of mapping, this changes!</p>
<p>For the second round, grist does the following prior to generating the mapping results in the <code>leftover/</code> directory. 
1. for the first genome in the gather results,
2. maps reads to that genome
3. removes those reads from further consideration for mapping,
4. and then proceeds to the second step.</p>
<p>In effect, what this means is that if there's a region shared between multiple genomes in the minimum metagenome cover, all of the reads that would map to the shared region are "claimed" by the genome that is ranked earlier in the gather results.</p>
<p>Reads that did map to such a shared region but were claimed by an earlier genome are saved for each genome to a file with the extension <code>overlap.fq.gz</code> within the <code>mapping/</code> directory; reads that will be mapped to a particular genome are saved in a file <code>leftover.fq.gz</code>, also within the <code>mapping/</code> directory.</p>
<p>To summarize: under the <code>mapping/</code> directory,</p>
<ul>
<li>the <code>mapped.fq.gz</code> files contain all the reads that map to the genomes;</li>
<li>the <code>leftover.fq.gz</code> files contain the subset of mapped reads that will be mapped to that genome in the second round;</li>
<li>the <code>overlap.fq.gz</code> files contain the subset of mapped reads that were removed from consideration due to overlap with an earlier rank genome;</li>
</ul>
<p>Then, the <code>leftover/</code> directory contains the mapping results for the <code>leftover.fq.gz</code>.</p>
<p>A key outcome of this is that <strong>read mapping information under <code>mapping/</code> includes multimapped reads</strong>. So you can't just e.g. sum the numbers of mapped reads from that directory, or you may be double-counting some reads. However, <strong>the read mapping information under <code>leftover/</code> only counts each read once</strong>, so you can work with those numbers more easily.</p>
<h2 id="details-of-specific-output-files">Details of specific output files</h2>
<h3 id="sourmash-outputs">sourmash outputs</h3>
<p>Primary outputs:</p>
<ul>
<li><code>{outdir}/gather/{sample}.gather.csv</code> - CSV output of <code>sourmash gather</code></li>
<li><code>{outdir}/gather/{sample}.gather.out</code> - human-readable output of <code>sourmash gather</code></li>
<li><code>{outdir}/gather/{sample}.gather.with-lineages.csv</code> - gather CSV annotated with taxonomy</li>
</ul>
<p>Interim outputs that are used or summarized elsewhere:</p>
<ul>
<li><code>{outdir}/gather/{sample}.prefetch.csv</code> - CSV output of <code>sourmash prefetch</code></li>
<li><code>{outdir}/gather/{sample}.genomes.info.csv</code> - summary information on matching genomes</li>
<li><code>{outdir}/gather/{sample}.prefetch.report.txt</code> - summary of prefetch information</li>
<li><code>{outdir}/gather/{sample}.known.sig.gz</code> - known sourmash hashes</li>
<li><code>{outdir}/gather/{sample}.unknown.sig.gz</code> - unknown sourmash hashes</li>
</ul>
<h3 id="mapping-outputs">mapping outputs</h3>
<h4 id="mapping-and-leftover-subdirectory-files"><code>mapping/</code> and <code>leftover/</code> subdirectory files</h4>
<p><code>{sample_id}.summary.csv</code> - summary of the mapping. See below for details.</p>
<ul>
<li><code>{sample_id}.x.{genome_id}.bam</code> - output of mapping</li>
<li><code>{sample_id}.x.{genome_id}.depth.txt</code> - output of <code>samtools depth</code></li>
<li><code>{sample_id}.x.{genome_id}.count_mapped_reads.txt</code> - output of <code>samtools view -c</code></li>
<li><code>{sample_id}.x.{genome_id}.leftover.fq.gz</code> - reads remaining after reads from earlier-rank gather results are mapped <strong>(only in <code>mapping/</code> subdirectory)</strong></li>
<li><code>{sample_id}.x.{genome_id}.mapped.fq.gz</code> - all of the mapped reads</li>
<li><code>{sample_id}.x.{genome_id}.overlap.fq.gz</code> - ...</li>
<li><code>{sample_id}.x.{genome_id}.bcf</code> - output of <code>samtools mpileup</code> and <code>samtools call</code> (BCF file)</li>
<li><code>{sample_id}.x.{genome_id}.vcf.gz</code> - output of <code>samtools mpileup</code> and <code>samtools call</code> (VCF file)</li>
<li><code>{sample_id}.x.{genome_id}.vcf.gz.csi</code> - ancillary output of <code>samtools mpileup</code> and <code>samtools call</code></li>
</ul>
<h4 id="mapping-summary-file-metagenomesummarycsv-in-mapping-and-leftover">mapping summary file: <code>{metagenome}.summary.csv</code> in <code>/mapping/</code> and <code>/leftover/</code></h4>
<p>these files are produced by <code>genome_grist/summarize_mapping.py</code> and contains one row for each genome in <code>{metagenome}</code>, with the following columns:</p>
<ul>
<li><code>index</code> - index column unique to each row.  Equivalent to <code>genome_id</code>.</li>
<li><code>genome_id</code> - genome identifier.</li>
<li><code>sample_id</code> - metagenome/sample identifier.</li>
<li><code>n_chrom</code> - number of contigs in the genome.</li>
<li><code>n_snps</code> - number of SNPs in the genome relative to the metagenome reads (as called by <code>samtools call</code>).</li>
<li><code>n_genome_bp</code> - size of genome in bp.</li>
<li><code>n_missed_bp</code> - the number of positions in the genome with 0 coverage.</li>
<li><code>f_missed_bp</code> - the fraction of the genome that has no matches: <code>missed</code> / <code>genome_bp</code>.</li>
<li><code>avg_coverage</code> - average coverage of genome; includes bases with 0 coverage.</li>
<li><code>effective_coverage</code> - sum of depth divided by number of covered bases; does not include bases with 0 coverage.</li>
<li><code>n_covered_bp</code> - the number of bp covered by at least one read.</li>
<li><code>f_covered_bp</code> - fraction of bp covered by at least one read, aka read-mapping-based "detection".</li>
<li><code>n_mapped_reads</code> - total count of primary mapped reads.</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
